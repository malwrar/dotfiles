---
# Attempt to install nvim
# TODO: implement, use e.g.
#   - include_tasks: setup-Archlinux.yml
#     when: ansible_os_family == 'Archlinux'

# TODO: correct config installation directory should be selected based on OS and set by installer subtask
- name: Create config directory
  file:
    path: "{{ home_dir }}/.config/nvim"
    state: directory
    recurse: yes
  register: nvim_config_dir

- name: Symlink init.vim file to the nvim config directory.
  file:
    src: "{{ role_path }}/files/init.vim"
    dest: "{{ nvim_config_dir.path }}/init.vim"
    state: link

# Install nvim theme file
- name: Create nvim theme directory
  file:
    path: "{{ nvim_config_dir.path }}/colors"
    state: directory
  register: nvim_themes_dir

- name: Render main theme template and install it.
  template:
    src: "{{ role_path }}/templates/main_theme.vim"
    dest: "{{ nvim_themes_dir.path }}/malwrar.vim"

# Install airline theme file
- name: Create airline theme directory
  file:
    path: "{{ nvim_config_dir.path }}/autoload/airline/themes"
    state: directory
  register: nvim_airline_themes_dir

- name: Render airline theme template and install it.
  template:
    src: "{{ role_path }}/templates/airline_theme.vim"
    dest: "{{ nvim_airline_themes_dir.path }}/malwrar.vim"

# Install plugins
- name: Install plugins 
  shell: "nvim +PlugInstall +PlugUpdate +PlugClean! +qall > /dev/null"
